<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Finance - Pengelola Dana Keluarga</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js CDN for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons for a modern icon set -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Custom CSS for futuristic theme -->
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #1a1a2e;
            --bg-glass: rgba(26, 26, 46, 0.6);
            --border-color: rgba(68, 85, 129, 0.5);
            --accent-primary: #00ffff; /* Cyan */
            --accent-secondary: #ff00ff; /* Magenta */
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0c0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            background-image:
                radial-gradient(circle at 1% 1%, var(--bg-secondary) 1px, transparent 1px),
                radial-gradient(circle at 99% 99%, var(--bg-secondary) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        .glass-card {
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .neon-glow {
            transition: all 0.3s ease-in-out;
        }

        .neon-glow-cyan {
            box-shadow: 0 0 5px var(--accent-primary), 0 0 10px var(--accent-primary);
        }

        .neon-text-cyan {
            text-shadow: 0 0 3px var(--accent-primary), 0 0 5px var(--accent-primary);
        }

        .neon-text-magenta {
             text-shadow: 0 0 3px var(--accent-secondary), 0 0 5px var(--accent-secondary);
        }
        
        .tab-btn.active {
            background-color: var(--accent-primary);
            color: var(--bg-primary);
            box-shadow: 0 0 10px var(--accent-primary), 0 0 20px var(--accent-primary);
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), 0 0 10px rgba(255, 0, 255, 0.5);
        }

        .btn-primary:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.7), 0 0 20px rgba(255, 0, 255, 0.7);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        ::-webkit-scrollbar-thumb {
            background-color: var(--accent-primary);
            border-radius: 10px;
            border: 2px solid var(--bg-primary);
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--accent-secondary);
        }

        /* Chart.js tooltip styling */
        .chartjs-tooltip {
            background: var(--bg-glass) !important;
            border: 1px solid var(--border-color) !important;
        }
    </style>
</head>
<body class="antialiased min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-8">
            <div class="flex items-center space-x-3 mb-4 sm:mb-0">
                <i class="ph-duotone ph-atom text-5xl text-cyan-300 neon-text-cyan"></i>
                <h1 class="text-3xl font-bold tracking-wider neon-text-cyan">Aura<span class="text-magenta-400 neon-text-magenta">Finance</span></h1>
            </div>
            <div id="dateTime" class="text-sm text-gray-400"></div>
        </header>

        <main class="grid grid-cols-12 gap-6">
            <!-- Sidebar / Navigation -->
            <aside class="col-span-12 lg:col-span-3">
                <div class="glass-card p-6 space-y-4">
                    <h2 class="text-lg font-semibold text-gray-300 mb-4">Menu</h2>
                    <nav class="space-y-2">
                        <button onclick="showTab('dashboard')" class="tab-btn w-full flex items-center space-x-3 p-3 rounded-lg transition-all duration-300 hover:bg-cyan-500/20 active">
                            <i class="ph ph-house text-xl"></i>
                            <span>Dasbor</span>
                        </button>
                        <button onclick="showTab('transactions')" class="tab-btn w-full flex items-center space-x-3 p-3 rounded-lg transition-all duration-300 hover:bg-cyan-500/20">
                            <i class="ph ph-arrows-left-right text-xl"></i>
                            <span>Transaksi</span>
                        </button>
                        <button onclick="showTab('budget')" class="tab-btn w-full flex items-center space-x-3 p-3 rounded-lg transition-all duration-300 hover:bg-cyan-500/20">
                            <i class="ph ph-target text-xl"></i>
                            <span>Anggaran</span>
                        </button>
                        <button onclick="showTab('reports')" class="tab-btn w-full flex items-center space-x-3 p-3 rounded-lg transition-all duration-300 hover:bg-cyan-500/20">
                            <i class="ph ph-chart-pie-slice text-xl"></i>
                            <span>Laporan</span>
                        </button>
                    </nav>
                </div>
            </aside>

            <!-- Main Content -->
            <section class="col-span-12 lg:col-span-9 space-y-6">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content space-y-6">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="glass-card p-6 flex flex-col justify-between">
                            <div class="flex justify-between items-start">
                                <h3 class="font-semibold text-gray-300">Total Saldo</h3>
                                <i class="ph-duotone ph-wallet text-3xl text-cyan-400"></i>
                            </div>
                            <p id="totalBalance" class="text-3xl font-bold mt-4 neon-text-cyan">Rp 0</p>
                        </div>
                        <div class="glass-card p-6 flex flex-col justify-between">
                            <div class="flex justify-between items-start">
                                <h3 class="font-semibold text-gray-300">Total Pemasukan</h3>
                                <i class="ph-duotone ph-arrow-circle-down text-3xl text-green-400"></i>
                            </div>
                            <p id="totalIncome" class="text-3xl font-bold mt-4 text-green-400">Rp 0</p>
                        </div>
                        <div class="glass-card p-6 flex flex-col justify-between">
                            <div class="flex justify-between items-start">
                                <h3 class="font-semibold text-gray-300">Total Pengeluaran</h3>
                                <i class="ph-duotone ph-arrow-circle-up text-3xl text-red-400"></i>
                            </div>
                            <p id="totalExpense" class="text-3xl font-bold mt-4 text-red-400">Rp 0</p>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <div class="glass-card p-6">
                            <h3 class="font-semibold text-gray-300 mb-4">Ikhtisar Arus Kas</h3>
                            <canvas id="flowChart"></canvas>
                        </div>
                        <div class="glass-card p-6">
                            <h3 class="font-semibold text-gray-300 mb-4">Pengeluaran per Kategori</h3>
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                     <!-- Recent Transactions -->
                    <div class="glass-card p-6">
                        <h3 class="font-semibold text-gray-300 mb-4">Transaksi Terakhir</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="border-b border-gray-600">
                                    <tr>
                                        <th class="p-3">Tanggal</th>
                                        <th class="p-3">Deskripsi</th>
                                        <th class="p-3">Kategori</th>
                                        <th class="p-3 text-right">Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody id="recentTransactionsList">
                                    <!-- Dynamic content here -->
                                    <tr><td colspan="4" class="text-center p-4 text-gray-400">Belum ada transaksi.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Transactions Tab -->
                <div id="transactions" class="tab-content hidden space-y-6">
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-bold mb-4 neon-text-cyan">Tambah Transaksi Baru</h2>
                        <form id="transactionForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="tr-type" class="block text-sm font-medium text-gray-400 mb-1">Tipe</label>
                                <select id="tr-type" class="w-full bg-gray-900/50 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                                    <option value="income">Pemasukan</option>
                                    <option value="expense">Pengeluaran</option>
                                </select>
                            </div>
                            <div>
                                <label for="tr-amount" class="block text-sm font-medium text-gray-400 mb-1">Jumlah (Rp)</label>
                                <input type="number" id="tr-amount" placeholder="50000" required class="w-full bg-gray-900/50 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                            </div>
                            <div class="md:col-span-2">
                                <label for="tr-description" class="block text-sm font-medium text-gray-400 mb-1">Deskripsi</label>
                                <input type="text" id="tr-description" placeholder="Beli Kopi" required class="w-full bg-gray-900/50 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                            </div>
                            <div>
                                <label for="tr-category" class="block text-sm font-medium text-gray-400 mb-1">Kategori</label>
                                <select id="tr-category" class="w-full bg-gray-900/50 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                                    <option>Makanan</option>
                                    <option>Transportasi</option>
                                    <option>Tagihan</option>
                                    <option>Hiburan</option>
                                    <option>Gaji</option>
                                    <option>Lainnya</option>
                                </select>
                            </div>
                            <div>
                                <label for="tr-date" class="block text-sm font-medium text-gray-400 mb-1">Tanggal</label>
                                <input type="date" id="tr-date" required class="w-full bg-gray-900/50 border border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition">
                            </div>
                            <div class="md:col-span-2 text-right">
                                <button type="submit" class="btn-primary font-bold py-2 px-6 rounded-lg">
                                    Simpan Transaksi
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-bold mb-4 neon-text-cyan">Riwayat Transaksi</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead class="border-b border-gray-600">
                                    <tr>
                                        <th class="p-3">Tanggal</th>
                                        <th class="p-3">Deskripsi</th>
                                        <th class="p-3">Kategori</th>
                                        <th class="p-3 text-right">Jumlah</th>
                                        <th class="p-3 text-center">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="fullTransactionsList">
                                    <!-- Dynamic content here -->
                                    <tr><td colspan="5" class="text-center p-4 text-gray-400">Belum ada transaksi.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Budget Tab -->
                <div id="budget" class="tab-content hidden space-y-6">
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-bold mb-4 neon-text-cyan">Anggaran Bulanan</h2>
                        <div id="budgetList" class="space-y-4">
                           <!-- JS will populate this -->
                           <p class="text-gray-400">Anggaran belum diatur.</p>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div id="reports" class="tab-content hidden space-y-6">
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-bold mb-4 neon-text-cyan">Laporan Keuangan</h2>
                        <p class="text-gray-400">Fitur laporan detail akan segera hadir. Saat ini, silakan lihat grafik di dasbor.</p>
                        <!-- Future report elements can go here -->
                    </div>
                </div>

            </section>
        </main>
    </div>

<script>
    // --- State Management ---
    let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
    let budgets = JSON.parse(localStorage.getItem('budgets')) || [
        { category: 'Makanan', allocated: 500000, spent: 0 },
        { category: 'Transportasi', allocated: 300000, spent: 0 },
        { category: 'Tagihan', allocated: 750000, spent: 0 },
        { category: 'Hiburan', allocated: 250000, spent: 0 },
    ];

    // --- Chart instances ---
    let flowChartInstance;
    let categoryChartInstance;

    // --- Utility Functions ---
    const formatCurrency = (amount) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
    const formatDate = (dateString) => new Date(dateString).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });

    // --- UI Navigation ---
    const tabs = document.querySelectorAll('.tab-content');
    const tabBtns = document.querySelectorAll('.tab-btn');

    function showTab(tabId) {
        tabs.forEach(tab => tab.classList.add('hidden'));
        document.getElementById(tabId).classList.remove('hidden');

        tabBtns.forEach(btn => btn.classList.remove('active'));
        document.querySelector(`button[onclick="showTab('${tabId}')"]`).classList.add('active');
    }

    // --- Core Logic ---
    function addTransaction(e) {
        e.preventDefault();
        const type = document.getElementById('tr-type').value;
        const amount = parseFloat(document.getElementById('tr-amount').value);
        const description = document.getElementById('tr-description').value;
        const category = document.getElementById('tr-category').value;
        const date = document.getElementById('tr-date').value;

        if (!amount || !description || !date) {
            alert('Harap isi semua kolom.');
            return;
        }

        const newTransaction = {
            id: Date.now(),
            type,
            amount,
            description,
            category,
            date,
        };

        transactions.push(newTransaction);
        saveAndRerender();
        document.getElementById('transactionForm').reset();
        showTab('dashboard'); // Switch to dashboard to see update
    }

    function deleteTransaction(id) {
        if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
            transactions = transactions.filter(tr => tr.id !== id);
            saveAndRerender();
        }
    }
    
    // --- Rendering Functions ---
    function renderSummary() {
        const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
        const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
        const totalBalance = totalIncome - totalExpense;

        document.getElementById('totalBalance').textContent = formatCurrency(totalBalance);
        document.getElementById('totalIncome').textContent = formatCurrency(totalIncome);
        document.getElementById('totalExpense').textContent = formatCurrency(totalExpense);
    }
    
    function renderRecentTransactions() {
        const list = document.getElementById('recentTransactionsList');
        list.innerHTML = '';
        const recent = [...transactions].sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 5);

        if (recent.length === 0) {
            list.innerHTML = '<tr><td colspan="4" class="text-center p-4 text-gray-400">Belum ada transaksi.</td></tr>';
            return;
        }

        recent.forEach(tr => {
            const row = document.createElement('tr');
            row.className = `border-b border-gray-700/50 ${tr.type === 'income' ? 'hover:bg-green-500/10' : 'hover:bg-red-500/10'}`;
            row.innerHTML = `
                <td class="p-3 text-gray-400">${formatDate(tr.date)}</td>
                <td class="p-3">${tr.description}</td>
                <td class="p-3 text-gray-400">${tr.category}</td>
                <td class="p-3 text-right font-semibold ${tr.type === 'income' ? 'text-green-400' : 'text-red-400'}">
                    ${tr.type === 'income' ? '+' : '-'} ${formatCurrency(tr.amount)}
                </td>
            `;
            list.appendChild(row);
        });
    }

    function renderAllTransactions() {
        const list = document.getElementById('fullTransactionsList');
        list.innerHTML = '';
        const allSorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));

        if (allSorted.length === 0) {
            list.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-gray-400">Belum ada transaksi.</td></tr>';
            return;
        }

        allSorted.forEach(tr => {
            const row = document.createElement('tr');
            row.className = `border-b border-gray-700/50 ${tr.type === 'income' ? 'hover:bg-green-500/10' : 'hover:bg-red-500/10'}`;
            row.innerHTML = `
                <td class="p-3 text-gray-400">${formatDate(tr.date)}</td>
                <td class="p-3">${tr.description}</td>
                <td class="p-3 text-gray-400">${tr.category}</td>
                <td class="p-3 text-right font-semibold ${tr.type === 'income' ? 'text-green-400' : 'text-red-400'}">
                    ${tr.type === 'income' ? '+' : '-'} ${formatCurrency(tr.amount)}
                </td>
                <td class="p-3 text-center">
                    <button onclick="deleteTransaction(${tr.id})" class="text-red-400 hover:text-red-200 transition">
                        <i class="ph ph-trash"></i>
                    </button>
                </td>
            `;
            list.appendChild(row);
        });
    }
    
    function renderBudgets() {
        // First, calculate current spending per budget category
        budgets.forEach(budget => {
            budget.spent = transactions
                .filter(tr => tr.type === 'expense' && tr.category === budget.category)
                .reduce((sum, tr) => sum + tr.amount, 0);
        });

        const budgetContainer = document.getElementById('budgetList');
        budgetContainer.innerHTML = '';
        
        if (budgets.length === 0) {
            budgetContainer.innerHTML = '<p class="text-gray-400">Anggaran belum diatur.</p>';
            return;
        }

        budgets.forEach(budget => {
            const percentage = (budget.spent / budget.allocated) * 100;
            const progressColor = percentage > 100 ? 'bg-red-500' : (percentage > 75 ? 'bg-yellow-500' : 'bg-cyan-500');

            const budgetEl = document.createElement('div');
            budgetEl.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <span class="font-medium">${budget.category}</span>
                    <span class="text-sm text-gray-400">${formatCurrency(budget.spent)} / ${formatCurrency(budget.allocated)}</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2.5">
                    <div class="${progressColor} h-2.5 rounded-full" style="width: ${Math.min(percentage, 100)}%"></div>
                </div>
                ${percentage > 100 ? `<p class="text-xs text-red-400 mt-1">Melebihi anggaran sebesar ${formatCurrency(budget.spent - budget.allocated)}!</p>` : ''}
            `;
            budgetContainer.appendChild(budgetEl);
        });
    }

    function renderCharts() {
        const ctxFlow = document.getElementById('flowChart').getContext('2d');
        const ctxCategory = document.getElementById('categoryChart').getContext('2d');

        // Data for Income vs Expense Chart
        const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
        const incomeData = Array(12).fill(0);
        const expenseData = Array(12).fill(0);

        transactions.forEach(tr => {
            const month = new Date(tr.date).getMonth();
            if (tr.type === 'income') {
                incomeData[month] += tr.amount;
            } else {
                expenseData[month] += tr.amount;
            }
        });
        
        // Data for Category Doughnut Chart
        const expenseByCategory = transactions
            .filter(t => t.type === 'expense')
            .reduce((acc, t) => {
                acc[t.category] = (acc[t.category] || 0) + t.amount;
                return acc;
            }, {});

        const categoryLabels = Object.keys(expenseByCategory);
        const categoryData = Object.values(expenseByCategory);

        // Destroy previous chart instances if they exist
        if (flowChartInstance) flowChartInstance.destroy();
        if (categoryChartInstance) categoryChartInstance.destroy();

        // Create new charts
        flowChartInstance = new Chart(ctxFlow, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Pemasukan',
                        data: incomeData,
                        backgroundColor: 'rgba(0, 255, 255, 0.5)',
                        borderColor: 'rgba(0, 255, 255, 1)',
                        borderWidth: 1,
                        borderRadius: 5
                    },
                    {
                        label: 'Pengeluaran',
                        data: expenseData,
                        backgroundColor: 'rgba(255, 0, 255, 0.5)',
                        borderColor: 'rgba(255, 0, 255, 1)',
                        borderWidth: 1,
                        borderRadius: 5
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { labels: { color: 'var(--text-secondary)' } } },
                scales: {
                    y: { ticks: { color: 'var(--text-secondary)' }, grid: { color: 'var(--border-color)' } },
                    x: { ticks: { color: 'var(--text-secondary)' }, grid: { color: 'transparent' } }
                }
            }
        });

        categoryChartInstance = new Chart(ctxCategory, {
            type: 'doughnut',
            data: {
                labels: categoryLabels.length > 0 ? categoryLabels : ['Tidak ada data'],
                datasets: [{
                    label: 'Pengeluaran',
                    data: categoryData.length > 0 ? categoryData : [1],
                    backgroundColor: [
                        'rgba(0, 255, 255, 0.7)',
                        'rgba(255, 0, 255, 0.7)',
                        'rgba(138, 43, 226, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(255, 159, 64, 0.7)',
                    ],
                    borderColor: 'var(--bg-secondary)',
                    borderWidth: 2,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: 'var(--text-secondary)' }
                    }
                }
            }
        });
    }

    // --- Date/Time Display ---
    function updateDateTime() {
        const now = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        document.getElementById('dateTime').textContent = now.toLocaleDateString('id-ID', options);
    }

    // --- Main App Function ---
    function saveAndRerender() {
        localStorage.setItem('transactions', JSON.stringify(transactions));
        localStorage.setItem('budgets', JSON.stringify(budgets));
        renderSummary();
        renderRecentTransactions();
        renderAllTransactions();
        renderBudgets();
        renderCharts();
    }

    // --- Event Listeners and Initial Load ---
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('transactionForm').addEventListener('submit', addTransaction);
        document.getElementById('tr-date').valueAsDate = new Date();
        
        updateDateTime();
        setInterval(updateDateTime, 1000 * 60); // Update every minute
        
        saveAndRerender();
        showTab('dashboard'); // Set default tab
    });
</script>

</body>
</html>

